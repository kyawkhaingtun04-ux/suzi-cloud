<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <title>SUZI Cloud JSON Uploader</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Using Inter font (as per recommendation) -->
  <style>
    :root {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="min-h-screen bg-slate-100 flex items-center justify-center p-4">
Â  <div class="w-full max-w-md bg-white shadow-xl ring-1 ring-slate-200 rounded-2xl p-6 space-y-6">
Â  Â  <h1 class="text-2xl font-extrabold text-slate-800 text-center">
Â  Â  Â  SUZI Cloud JSON Uploader
Â  Â  </h1>

Â  Â  <!-- API Key Input -->
Â  Â  <div>
Â  Â  Â  <label class="block text-sm font-medium text-slate-700 mb-1" for="apiKey">
Â  Â  Â  Â  API Password (X-Api-Key)
Â  Â  Â  </label>
Â  Â  Â  <input
Â  Â  Â  Â  id="apiKey"
Â  Â  Â  Â  type="password"
Â  Â  Â  Â  class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150"
Â  Â  Â  Â  placeholder="Enter your API key"
Â  Â  Â  />
Â  Â  Â  <p class="text-xs text-slate-500 mt-1">
Â  Â  Â  Â  â€» This key is sent as <code>X-Api-Key</code> header to authenticate the upload.
Â  Â  Â  </p>
Â  Â  </div>

Â  Â  <!-- File Input -->
Â  Â  <div>
Â  Â  Â  <label class="block text-sm font-medium text-slate-700 mb-1" for="jsonFile">
Â  Â  Â  Â  JSON File
Â  Â  Â  </label>
Â  Â  Â  <input
Â  Â  Â  Â  id="jsonFile"
Â  Â  Â  Â  type="file"
Â  Â  Â  Â  accept=".json,application/json"
Â  Â  Â  Â  class="w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
Â  Â  Â  />
Â  Â  Â  <p class="text-xs text-slate-500 mt-1">
Â  Â  Â  Â  Upload a <code>.json</code> file. It will be stored using its filename (without extension).
Â  Â  Â  </p>
Â  Â  </div>

Â  Â  <!-- Upload Button -->
Â  Â  <button
Â  Â  Â  id="uploadBtn"
Â  Â  Â  class="w-full inline-flex items-center justify-center rounded-xl px-4 py-2.5 text-sm font-semibold bg-blue-600 text-white shadow-lg shadow-blue-500/50 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150"
Â  Â  >
Â  Â  Â  Upload to Suzi Cloud
Â  Â  </button>

Â  Â  <!-- Status Area: Added h-5 for layout stability -->
Â  Â  <div id="status" class="text-sm text-slate-700 h-5"></div>

Â  Â  <!-- Response JSON -->
Â  Â  <pre
Â  Â  Â  id="responseBox"
Â  Â  Â  class="mt-2 max-h-60 overflow-auto text-xs bg-slate-800 text-green-300 rounded-lg p-3 whitespace-pre-wrap hidden ring-1 ring-slate-700"
Â  Â  ></pre>
Â  </div>

Â  <script>
Â  Â  // Your Suzi Cloud URL (data_file endpoint)
Â  Â  const CLOUD_URL = "https://cloud-2-9ndj.onrender.com/data_file";

Â  Â  const apiKeyInput = document.getElementById("apiKey");
Â  Â  const fileInput = document.getElementById("jsonFile");
Â  Â  const uploadBtn = document.getElementById("uploadBtn");
Â  Â  const statusBox = document.getElementById("status");
Â  Â  const responseBox = document.getElementById("responseBox");

    /**
     * Updates the status message displayed to the user.
     * @param {string} message - The message to display.
     * @param {boolean} isError - True if the message is an error.
     */
Â  Â  function setStatus(message, isError = false) {
Â  Â  Â  statusBox.textContent = message;
Â  Â  Â  statusBox.className =
Â  Â  Â  Â  "text-sm mt-1 h-5 " + (isError ? "text-red-600 font-medium" : "text-green-700 font-medium");
Â  Â  }

    /**
     * Displays the JSON response object in the formatted pre block.
     * @param {object} obj - The JSON object to display.
     */
Â  Â  function showResponse(obj) {
Â  Â  Â  responseBox.textContent = JSON.stringify(obj, null, 2);
Â  Â  Â  responseBox.classList.remove("hidden");
Â  Â  }

Â  Â  uploadBtn.addEventListener("click", async () => {
Â  Â  Â  const apiKey = apiKeyInput.value.trim();
Â  Â  Â  const file = fileInput.files[0];

Â  Â  Â  // 1. Check API key
Â  Â  Â  if (!apiKey) {
Â  Â  Â  Â  setStatus("API key is empty. Please enter your password API.", true);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // 2. Check file
Â  Â  Â  if (!file) {
Â  Â  Â  Â  setStatus("Please select a JSON file before uploading.", true);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Extra check: file extension
Â  Â  Â  if (!file.name.toLowerCase().endsWith(".json")) {
Â  Â  Â  Â  setStatus("Only .json files are allowed.", true);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // 3. Prepare FormData for file upload
Â  Â  Â  const formData = new FormData();
Â  Â  Â  // IMPORTANT: field name must be "file" to match FastAPI parameter name
Â  Â  Â  formData.append("file", file);

Â  Â  Â  // Set UI state for upload
Â  Â  Â  uploadBtn.disabled = true;
Â  Â  Â  setStatus("Uploading...", false);
Â  Â  Â  responseBox.classList.add("hidden");
Â  Â  Â  responseBox.textContent = "";

Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(CLOUD_URL, {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  // Let browser set Content-Type (with boundary) automatically for FormData.
Â  Â  Â  Â  Â  Â  "X-Api-Key": apiKey,
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: formData,
Â  Â  Â  Â  });

        // Attempt to parse response body as JSON, catching errors if it's not JSON
Â  Â  Â  Â  const data = await res.json().catch((e) => {
            console.warn("Could not parse response body as JSON:", e);
            return { detail: res.statusText }; // Fallback detail
        });

Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  setStatus(
Â  Â  Â  Â  Â  Â  `Upload failed (${res.status}). ` +
Â  Â  Â  Â  Â  Â  Â  (data && data.detail ? data.detail : "Unknown error."),
Â  Â  Â  Â  Â  Â  true
Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  if (data) showResponse(data);
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  setStatus("Upload success! ðŸŽ‰ The file is now available on Suzi Cloud.", false);
Â  Â  Â  Â  if (data) showResponse(data);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("Fetch Error:", err);
Â  Â  Â  Â  setStatus("Network error or CORS issue. Check console for details.", true);
Â  Â  Â  } finally {
Â  Â  Â  Â  uploadBtn.disabled = false;
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>
